/*! For license information please see taskpane.js.LICENSE.txt */
!function(){var e={14385:function(e){"use strict";e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),t.hash&&(e+=t.hash),t.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(e)?'"'.concat(e,'"'):e):e}},44809:function(e,t){var n,r;n=function e(){var t,n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:{},r=!n.document&&!!n.postMessage,o=n.IS_PAPA_WORKER||!1,i={},s=0,a={};function c(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=b(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new h(t),(this._handle.streamer=this)._config=t}.call(this,e),this.parseChunk=function(e,t){var r=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<r){let t=this._config.newline;t||(i=this._config.quoteChar||'"',t=this._handle.guessLineEndings(e,i)),e=[...e.split(t).slice(r)].join(t)}this.isFirstChunk&&_(this._config.beforeFirstChunk)&&void 0!==(i=this._config.beforeFirstChunk(e))&&(e=i),this.isFirstChunk=!1,this._halted=!1,r=this._partialLine+e;var i=(this._partialLine="",this._handle.parse(r,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(e=i.meta.cursor,this._finished||(this._partialLine=r.substring(e-this._baseIndex),this._baseIndex=e),i&&i.data&&(this._rowCount+=i.data.length),r=this._finished||this._config.preview&&this._rowCount>=this._config.preview,o)n.postMessage({results:i,workerId:a.WORKER_ID,finished:r});else if(_(this._config.chunk)&&!t){if(this._config.chunk(i,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=i=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(i.data),this._completeResults.errors=this._completeResults.errors.concat(i.errors),this._completeResults.meta=i.meta),this._completed||!r||!_(this._config.complete)||i&&i.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),r||i&&i.meta.paused||this._nextChunk(),i}this._halted=!0},this._sendError=function(e){_(this._config.error)?this._config.error(e):o&&this._config.error&&n.postMessage({workerId:a.WORKER_ID,error:e,finished:!1})}}function u(e){var t;(e=e||{}).chunkSize||(e.chunkSize=a.RemoteChunkSize),c.call(this,e),this._nextChunk=r?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),r||(t.onload=w(this._chunkLoaded,this),t.onerror=w(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!r),this._config.downloadRequestHeaders){var e,n=this._config.downloadRequestHeaders;for(e in n)t.setRequestHeader(e,n[e])}var o;this._config.chunkSize&&(o=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+o));try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}r&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(e=>null!==(e=e.getResponseHeader("Content-Range"))?parseInt(e.substring(e.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){e=t.statusText||e,this._sendError(new Error(e))}}function l(e){(e=e||{}).chunkSize||(e.chunkSize=a.LocalChunkSize),c.call(this,e);var t,n,r="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,n=e.slice||e.webkitSlice||e.mozSlice,r?((t=new FileReader).onload=w(this._chunkLoaded,this),t.onerror=w(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input,o=(this._config.chunkSize&&(o=Math.min(this._start+this._config.chunkSize,this._input.size),e=n.call(e,this._start,o)),t.readAsText(e,this._config.encoding));r||this._chunkLoaded({target:{result:o}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function d(e){var t;c.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){var e,n;if(!this._finished)return e=this._config.chunkSize,t=e?(n=t.substring(0,e),t.substring(e)):(n=t,""),this._finished=!t,this.parseChunk(n)}}function f(e){c.call(this,e=e||{});var t=[],n=!0,r=!1;this.pause=function(){c.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){c.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){r&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):n=!0},this._streamData=w(function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}},this),this._streamError=w(function(e){this._streamCleanUp(),this._sendError(e)},this),this._streamEnd=w(function(){this._streamCleanUp(),r=!0,this._streamData("")},this),this._streamCleanUp=w(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function h(e){var t,n,r,o,i=Math.pow(2,53),s=-i,c=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,u=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,l=this,d=0,f=0,h=!1,m=!1,y=[],v={data:[],errors:[],meta:{}};function w(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function E(){if(v&&r&&(S("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),r=!1),e.skipEmptyLines&&(v.data=v.data.filter(function(e){return!w(e)})),x()){if(v)if(Array.isArray(v.data[0])){for(var t=0;x()&&t<v.data.length;t++)v.data[t].forEach(n);v.data.splice(0,1)}else v.data.forEach(n);function n(t,n){_(e.transformHeader)&&(t=e.transformHeader(t,n)),y.push(t)}}function o(t,n){for(var r=e.header?{}:[],o=0;o<t.length;o++){var a=o,l=t[o];l=((t,n)=>(t=>(e.dynamicTypingFunction&&void 0===e.dynamicTyping[t]&&(e.dynamicTyping[t]=e.dynamicTypingFunction(t)),!0===(e.dynamicTyping[t]||e.dynamicTyping)))(t)?"true"===n||"TRUE"===n||"false"!==n&&"FALSE"!==n&&((e=>{if(c.test(e)&&(e=parseFloat(e),s<e&&e<i))return 1})(n)?parseFloat(n):u.test(n)?new Date(n):""===n?null:n):n)(a=e.header?o>=y.length?"__parsed_extra":y[o]:a,l=e.transform?e.transform(l,a):l),"__parsed_extra"===a?(r[a]=r[a]||[],r[a].push(l)):r[a]=l}return e.header&&(o>y.length?S("FieldMismatch","TooManyFields","Too many fields: expected "+y.length+" fields but parsed "+o,f+n):o<y.length&&S("FieldMismatch","TooFewFields","Too few fields: expected "+y.length+" fields but parsed "+o,f+n)),r}var l;v&&(e.header||e.dynamicTyping||e.transform)&&(l=1,!v.data.length||Array.isArray(v.data[0])?(v.data=v.data.map(o),l=v.data.length):v.data=o(v.data,0),e.header&&v.meta&&(v.meta.fields=y),f+=l)}function x(){return e.header&&0===y.length}function S(e,t,n,r){e={type:e,code:t,message:n},void 0!==r&&(e.row=r),v.errors.push(e)}_(e.step)&&(o=e.step,e.step=function(t){v=t,x()?E():(E(),0!==v.data.length&&(d+=t.data.length,e.preview&&d>e.preview?n.abort():(v.data=v.data[0],o(v,l))))}),this.parse=function(o,i,s){var c=e.quoteChar||'"';return e.newline||(e.newline=this.guessLineEndings(o,c)),r=!1,e.delimiter?_(e.delimiter)&&(e.delimiter=e.delimiter(o),v.meta.delimiter=e.delimiter):((c=((t,n,r,o,i)=>{var s,c,u,l;i=i||[",","\t","|",";",a.RECORD_SEP,a.UNIT_SEP];for(var d=0;d<i.length;d++){for(var f,h=i[d],p=0,m=0,y=0,v=(u=void 0,new g({comments:o,delimiter:h,newline:n,preview:10}).parse(t)),b=0;b<v.data.length;b++)r&&w(v.data[b])?y++:(m+=f=v.data[b].length,void 0===u?u=f:0<f&&(p+=Math.abs(f-u),u=f));0<v.data.length&&(m/=v.data.length-y),(void 0===c||p<=c)&&(void 0===l||l<m)&&1.99<m&&(c=p,s=h,l=m)}return{successful:!!(e.delimiter=s),bestDelimiter:s}})(o,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=c.bestDelimiter:(r=!0,e.delimiter=a.DefaultDelimiter),v.meta.delimiter=e.delimiter),c=b(e),e.preview&&e.header&&c.preview++,t=o,n=new g(c),v=n.parse(t,i,s),E(),h?{meta:{paused:!0}}:v||{meta:{paused:!1}}},this.paused=function(){return h},this.pause=function(){h=!0,n.abort(),t=_(e.chunk)?"":t.substring(n.getCharIndex())},this.resume=function(){l.streamer._halted?(h=!1,l.streamer.parseChunk(t,!0)):setTimeout(l.resume,3)},this.aborted=function(){return m},this.abort=function(){m=!0,n.abort(),v.meta.aborted=!0,_(e.complete)&&e.complete(v),t=""},this.guessLineEndings=function(e,t){e=e.substring(0,1048576),t=new RegExp(p(t)+"([^]*?)"+p(t),"gm");var n=(e=e.replace(t,"")).split("\r");if(e=1<(t=e.split("\n")).length&&t[0].length<n[0].length,1===n.length||e)return"\n";for(var r=0,o=0;o<n.length;o++)"\n"===n[o][0]&&r++;return r>=n.length/2?"\r\n":"\r"}}function p(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function g(e){var t=(e=e||{}).delimiter,n=e.newline,r=e.comments,o=e.step,i=e.preview,s=e.fastMode,c=null,u=!1,l=null==e.quoteChar?'"':e.quoteChar,d=l;if(void 0!==e.escapeChar&&(d=e.escapeChar),("string"!=typeof t||-1<a.BAD_DELIMITERS.indexOf(t))&&(t=","),r===t)throw new Error("Comment character same as delimiter");!0===r?r="#":("string"!=typeof r||-1<a.BAD_DELIMITERS.indexOf(r))&&(r=!1),"\n"!==n&&"\r"!==n&&"\r\n"!==n&&(n="\n");var f=0,h=!1;this.parse=function(a,g,m){if("string"!=typeof a)throw new Error("Input must be a string");var y=a.length,v=t.length,b=n.length,w=r.length,E=_(o),x=[],S=[],k=[],R=f=0;if(!a)return P();if(s||!1!==s&&-1===a.indexOf(l)){for(var C=a.split(n),I=0;I<C.length;I++){if(k=C[I],f+=k.length,I!==C.length-1)f+=n.length;else if(m)return P();if(!r||k.substring(0,w)!==r){if(E){if(x=[],N(k.split(t)),B(),h)return P()}else N(k.split(t));if(i&&i<=I)return x=x.slice(0,i),P(!0)}}return P()}for(var O=a.indexOf(t,f),T=a.indexOf(n,f),$=new RegExp(p(d)+p(l),"g"),A=a.indexOf(l,f);;)if(a[f]===l)for(A=f,f++;;){if(-1===(A=a.indexOf(l,A+1)))return m||S.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:x.length,index:f}),M();if(A===y-1)return M(a.substring(f,A).replace($,l));if(l===d&&a[A+1]===d)A++;else if(l===d||0===A||a[A-1]!==d){-1!==O&&O<A+1&&(O=a.indexOf(t,A+1));var D=L(-1===(T=-1!==T&&T<A+1?a.indexOf(n,A+1):T)?O:Math.min(O,T));if(a.substr(A+1+D,v)===t){k.push(a.substring(f,A).replace($,l)),a[f=A+1+D+v]!==l&&(A=a.indexOf(l,f)),O=a.indexOf(t,f),T=a.indexOf(n,f);break}if(D=L(T),a.substring(A+1+D,A+1+D+b)===n){if(k.push(a.substring(f,A).replace($,l)),F(A+1+D+b),O=a.indexOf(t,f),A=a.indexOf(l,f),E&&(B(),h))return P();if(i&&x.length>=i)return P(!0);break}S.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:x.length,index:f}),A++}}else if(r&&0===k.length&&a.substring(f,f+w)===r){if(-1===T)return P();f=T+b,T=a.indexOf(n,f),O=a.indexOf(t,f)}else if(-1!==O&&(O<T||-1===T))k.push(a.substring(f,O)),f=O+v,O=a.indexOf(t,f);else{if(-1===T)break;if(k.push(a.substring(f,T)),F(T+b),E&&(B(),h))return P();if(i&&x.length>=i)return P(!0)}return M();function N(e){x.push(e),R=f}function L(e){return-1!==e&&(e=a.substring(A+1,e))&&""===e.trim()?e.length:0}function M(e){return m||(void 0===e&&(e=a.substring(f)),k.push(e),f=y,N(k),E&&B()),P()}function F(e){f=e,N(k),k=[],T=a.indexOf(n,f)}function P(r){if(e.header&&!g&&x.length&&!u){var o=x[0],i=Object.create(null),s=new Set(o);let t=!1;for(let n=0;n<o.length;n++){let r=o[n];if(i[r=_(e.transformHeader)?e.transformHeader(r,n):r]){let e,a=i[r];for(;e=r+"_"+a,a++,s.has(e););s.add(e),o[n]=e,i[r]++,t=!0,(c=null===c?{}:c)[e]=r}else i[r]=1,o[n]=r;s.add(r)}t&&console.warn("Duplicate headers found and renamed."),u=!0}return{data:x,errors:S,meta:{delimiter:t,linebreak:n,aborted:h,truncated:!!r,cursor:R+(g||0),renamedHeaders:c}}}function B(){o(P()),x=[],S=[]}},this.abort=function(){h=!0},this.getCharIndex=function(){return f}}function m(e){var t=e.data,n=i[t.workerId],r=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var o={abort:function(){r=!0,y(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:v,resume:v};if(_(n.userStep)){for(var s=0;s<t.results.data.length&&(n.userStep({data:t.results.data[s],errors:t.results.errors,meta:t.results.meta},o),!r);s++);delete t.results}else _(n.userChunk)&&(n.userChunk(t.results,o,t.file),delete t.results)}t.finished&&!r&&y(t.workerId,t.results)}function y(e,t){var n=i[e];_(n.userComplete)&&n.userComplete(t),n.terminate(),delete i[e]}function v(){throw new Error("Not implemented.")}function b(e){if("object"!=typeof e||null===e)return e;var t,n=Array.isArray(e)?[]:{};for(t in e)n[t]=b(e[t]);return n}function w(e,t){return function(){e.apply(t,arguments)}}function _(e){return"function"==typeof e}return a.parse=function(t,r){var o=(r=r||{}).dynamicTyping||!1;if(_(o)&&(r.dynamicTypingFunction=o,o={}),r.dynamicTyping=o,r.transform=!!_(r.transform)&&r.transform,!r.worker||!a.WORKERS_SUPPORTED)return o=null,a.NODE_STREAM_INPUT,"string"==typeof t?(t=(e=>65279!==e.charCodeAt(0)?e:e.slice(1))(t),o=new(r.download?u:d)(r)):!0===t.readable&&_(t.read)&&_(t.on)?o=new f(r):(n.File&&t instanceof File||t instanceof Object)&&(o=new l(r)),o.stream(t);(o=(()=>{var t;return!!a.WORKERS_SUPPORTED&&(t=(()=>{var t=n.URL||n.webkitURL||null,r=e.toString();return a.BLOB_URL||(a.BLOB_URL=t.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",r,")();"],{type:"text/javascript"})))})(),(t=new n.Worker(t)).onmessage=m,t.id=s++,i[t.id]=t)})()).userStep=r.step,o.userChunk=r.chunk,o.userComplete=r.complete,o.userError=r.error,r.step=_(r.step),r.chunk=_(r.chunk),r.complete=_(r.complete),r.error=_(r.error),delete r.worker,o.postMessage({input:t,config:r,workerId:o.id})},a.unparse=function(e,t){var n=!1,r=!0,o=",",i="\r\n",s='"',c=s+s,u=!1,l=null,d=!1,f=((()=>{if("object"==typeof t){if("string"!=typeof t.delimiter||a.BAD_DELIMITERS.filter(function(e){return-1!==t.delimiter.indexOf(e)}).length||(o=t.delimiter),"boolean"!=typeof t.quotes&&"function"!=typeof t.quotes&&!Array.isArray(t.quotes)||(n=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(u=t.skipEmptyLines),"string"==typeof t.newline&&(i=t.newline),"string"==typeof t.quoteChar&&(s=t.quoteChar),"boolean"==typeof t.header&&(r=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");l=t.columns}void 0!==t.escapeChar&&(c=t.escapeChar+s),t.escapeFormulae instanceof RegExp?d=t.escapeFormulae:"boolean"==typeof t.escapeFormulae&&t.escapeFormulae&&(d=/^[=+\-@\t\r].*$/)}})(),new RegExp(p(s),"g"));if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return h(null,e,u);if("object"==typeof e[0])return h(l||Object.keys(e[0]),e,u)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||l),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:"object"==typeof e.data[0]?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),h(e.fields||[],e.data||[],u);throw new Error("Unable to serialize unrecognized input");function h(e,t,n){var s="",a=("string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t)),Array.isArray(e)&&0<e.length),c=!Array.isArray(t[0]);if(a&&r){for(var u=0;u<e.length;u++)0<u&&(s+=o),s+=g(e[u],u);0<t.length&&(s+=i)}for(var l=0;l<t.length;l++){var d=(a?e:t[l]).length,f=!1,h=a?0===Object.keys(t[l]).length:0===t[l].length;if(n&&!a&&(f="greedy"===n?""===t[l].join("").trim():1===t[l].length&&0===t[l][0].length),"greedy"===n&&a){for(var p=[],m=0;m<d;m++){var y=c?e[m]:m;p.push(t[l][y])}f=""===p.join("").trim()}if(!f){for(var v=0;v<d;v++){0<v&&!h&&(s+=o);var b=a&&c?e[v]:v;s+=g(t[l][b],v)}l<t.length-1&&(!n||0<d&&!h)&&(s+=i)}}return s}function g(e,t){var r,i;return null==e?"":e.constructor===Date?JSON.stringify(e).slice(1,25):(i=!1,d&&"string"==typeof e&&d.test(e)&&(e="'"+e,i=!0),r=e.toString().replace(f,c),(i=i||!0===n||"function"==typeof n&&n(e,t)||Array.isArray(n)&&n[t]||((e,t)=>{for(var n=0;n<t.length;n++)if(-1<e.indexOf(t[n]))return!0;return!1})(r,a.BAD_DELIMITERS)||-1<r.indexOf(o)||" "===r.charAt(0)||" "===r.charAt(r.length-1))?s+r+s:r)}},a.RECORD_SEP=String.fromCharCode(30),a.UNIT_SEP=String.fromCharCode(31),a.BYTE_ORDER_MARK="\ufeff",a.BAD_DELIMITERS=["\r","\n",'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!r&&!!n.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=10485760,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=g,a.ParserHandle=h,a.NetworkStreamer=u,a.FileStreamer=l,a.StringStreamer=d,a.ReadableStreamStreamer=f,n.jQuery&&((t=n.jQuery).fn.parse=function(e){var r=e.config||{},o=[];return this.each(function(e){if("INPUT"!==t(this).prop("tagName").toUpperCase()||"file"!==t(this).attr("type").toLowerCase()||!n.FileReader||!this.files||0===this.files.length)return!0;for(var i=0;i<this.files.length;i++)o.push({file:this.files[i],inputElem:this,instanceConfig:t.extend({},r)})}),i(),this;function i(){if(0===o.length)_(e.complete)&&e.complete();else{var n,r,i,c=o[0];if(_(e.before)){var u=e.before(c.file,c.inputElem);if("object"==typeof u){if("abort"===u.action)return n=c.file,r=c.inputElem,i=u.reason,void(_(e.error)&&e.error({name:"AbortError"},n,r,i));if("skip"===u.action)return void s();"object"==typeof u.config&&(c.instanceConfig=t.extend(c.instanceConfig,u.config))}else if("skip"===u)return void s()}var l=c.instanceConfig.complete;c.instanceConfig.complete=function(e){_(l)&&l(e,c.file,c.inputElem),s()},a.parse(c.file,c.instanceConfig)}}function s(){o.splice(0,1),i()}}),o&&(n.onmessage=function(e){e=e.data,void 0===a.WORKER_ID&&e&&(a.WORKER_ID=e.workerId),"string"==typeof e.input?n.postMessage({workerId:a.WORKER_ID,results:a.parse(e.input,e.config),finished:!0}):(n.File&&e.input instanceof File||e.input instanceof Object)&&(e=a.parse(e.input,e.config))&&n.postMessage({workerId:a.WORKER_ID,results:e,finished:!0})}),(u.prototype=Object.create(c.prototype)).constructor=u,(l.prototype=Object.create(c.prototype)).constructor=l,(d.prototype=Object.create(d.prototype)).constructor=d,(f.prototype=Object.create(c.prototype)).constructor=f,a},void 0===(r=n.apply(t,[]))||(e.exports=r)},58394:function(e,t,n){"use strict";e.exports=n.p+"ba1c167438c536bef669.css"}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.m=e,n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=r[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),n.b="undefined"!=typeof document&&document.baseURI||self.location.href,function(){"use strict";function e(e){return"function"==typeof e}function t(t){return function(n){if(function(t){return e(null==t?void 0:t.lift)}(n))return n.lift(function(e){try{return t(e,this)}catch(e){this.error(e)}});throw new TypeError("Unable to lift unknown Observable type")}}var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)};function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function i(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function a(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var c,u=((c=function(e){var t;t=this,Error.call(t),t.stack=(new Error).stack,this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}).prototype=Object.create(Error.prototype),c.prototype.constructor=c,c);function l(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var d=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var n;return t.prototype.unsubscribe=function(){var t,n,r,o,c;if(!this.closed){this.closed=!0;var l=this._parentage;if(l)if(this._parentage=null,Array.isArray(l))try{for(var d=i(l),f=d.next();!f.done;f=d.next())f.value.remove(this)}catch(e){t={error:e}}finally{try{f&&!f.done&&(n=d.return)&&n.call(d)}finally{if(t)throw t.error}}else l.remove(this);var p=this.initialTeardown;if(e(p))try{p()}catch(e){c=e instanceof u?e.errors:[e]}var g=this._finalizers;if(g){this._finalizers=null;try{for(var m=i(g),y=m.next();!y.done;y=m.next()){var v=y.value;try{h(v)}catch(e){c=null!=c?c:[],e instanceof u?c=a(a([],s(c)),s(e.errors)):c.push(e)}}}catch(e){r={error:e}}finally{try{y&&!y.done&&(o=m.return)&&o.call(m)}finally{if(r)throw r.error}}}if(c)throw new u(c)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)h(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}},t.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},t.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},t.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&l(t,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&l(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((n=new t).closed=!0,n),t}();function f(t){return t instanceof d||t&&"closed"in t&&e(t.remove)&&e(t.add)&&e(t.unsubscribe)}function h(t){e(t)?t():t.unsubscribe()}d.EMPTY;var p=null,g=null,m=void 0,y=!1,v=!1,b={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=b.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,a([e,t],s(n))):setTimeout.apply(void 0,a([e,t],s(n)))},clearTimeout:function(e){var t=b.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function w(){}var _=E("C",void 0,void 0);function E(e,t,n){return{kind:e,value:t,error:n}}var x=null,S=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,f(t)&&t.add(n)):n.destination=$,n}return o(t,e),t.create=function(e,t,n){return new I(e,t,n)},t.prototype.next=function(e){this.isStopped?T(function(e){return E("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?T(E("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?T(_,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(d),k=Function.prototype.bind;function R(e,t){return k.call(e,t)}var C=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){O(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){O(e)}else O(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){O(e)}},e}(),I=function(t){function n(n,r,o){var i,s,a=t.call(this)||this;return e(n)||!n?i={next:null!=n?n:void 0,error:null!=r?r:void 0,complete:null!=o?o:void 0}:a&&v?((s=Object.create(n)).unsubscribe=function(){return a.unsubscribe()},i={next:n.next&&R(n.next,s),error:n.error&&R(n.error,s),complete:n.complete&&R(n.complete,s)}):i=n,a.destination=new C(i),a}return o(n,t),n}(S);function O(e){var t;y?(t=e,y&&x&&(x.errorThrown=!0,x.error=t)):function(e){b.setTimeout(function(){if(!p)throw e;p(e)})}(e)}function T(e,t){var n=g;n&&b.setTimeout(function(){return n(e,t)})}var $={closed:!0,next:w,error:function(e){throw e},complete:w};function A(e,t,n,r,o){return new D(e,t,n,r,o)}var D=function(e){function t(t,n,r,o,i,s){var a=e.call(this,t)||this;return a.onFinalize=i,a.shouldUnsubscribe=s,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return o(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(S);function N(e,n){return t(function(t,r){var o=0;t.subscribe(A(r,function(t){r.next(e.call(n,t,o++))}))})}function L(e,n){return t(function(e,t,n){return function(r,o){var i=n,s=t,a=0;r.subscribe(A(o,function(t){var n=a++;s=i?e(s,t,n):(i=!0,t)},function(){i&&o.next(s),o.complete()}))}}(e,n,arguments.length>=2))}var M=function(e,t){return e.push(t),e};function F(){return t(function(e,t){L(M,[])(e).subscribe(t)})}function P(e){return e}function B(n,r,o){var i=e(n)||r||o?{next:n,error:r,complete:o}:n;return i?t(function(e,t){var n;null===(n=i.subscribe)||void 0===n||n.call(i);var r=!0;e.subscribe(A(t,function(e){var n;null===(n=i.next)||void 0===n||n.call(i,e),t.next(e)},function(){var e;r=!1,null===(e=i.complete)||void 0===e||e.call(i),t.complete()},function(e){var n;r=!1,null===(n=i.error)||void 0===n||n.call(i,e),t.error(e)},function(){var e,t;r&&(null===(e=i.unsubscribe)||void 0===e||e.call(i)),null===(t=i.finalize)||void 0===t||t.call(i)}))}):P}var j="function"==typeof Symbol&&Symbol.observable||"@@observable";var U=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,n,r){var o,i=this,s=(o=t)&&o instanceof S||function(t){return t&&e(t.next)&&e(t.error)&&e(t.complete)}(o)&&f(o)?t:new I(t,n,r);return function(e){if(y){var t=!x;if(t&&(x={errorThrown:!1,error:null}),e(),t){var n=x,r=n.errorThrown,o=n.error;if(x=null,r)throw o}}else e()}(function(){var e=i,t=e.operator,n=e.source;s.add(t?t.call(s,n):n?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},t.prototype.forEach=function(e,t){var n=this;return new(t=z(t))(function(t,r){var o=new I({next:function(t){try{e(t)}catch(e){r(e),o.unsubscribe()}},error:r,complete:t});n.subscribe(o)})},t.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},t.prototype[j]=function(){return this},t.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(n=e).length?P:1===n.length?n[0]:function(e){return n.reduce(function(e,t){return t(e)},e)})(this);var n},t.prototype.toPromise=function(e){var t=this;return new(e=z(e))(function(e,n){var r;t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})},t.create=function(e){return new t(e)},t}();function z(e){var t;return null!==(t=null!=e?e:m)&&void 0!==t?t:Promise}function H(e){return new U(t=>{Excel.run(async n=>{const r=n.workbook.names.getItemOrNullObject(e);r.load("type");try{await n.sync()}catch(n){return console.warn("Error getting range named '"+e+"':",n),t.next("Named range is empty or does not exist"),void t.complete()}if(r.isNullObject)return t.next("Named range is empty or does not exist"),void t.complete();if("range"!==String(r.type||"").toLowerCase()){try{r.load("value"),await n.sync();const e=r.value;null!=e&&""!==e?t.next(String(e)):t.next("Named range is empty or does not exist")}catch(e){console.warn("Named item is not a range and value could not be read:",e),t.next("Named range is empty or does not exist")}return void t.complete()}const o=r.getRange().getUsedRange();o.load("values");try{await n.sync()}catch(n){return console.warn("Error getting range named '"+e+"':",n),t.next("Named range is empty or does not exist"),void t.complete()}o.values&&o.values.length>0&&o.values[0].length>0?o.values.flat().filter((e,t,n)=>""!==e&&n.indexOf(e)===t).forEach(e=>t.next(e)):t.next("Named range is empty or does not exist"),t.complete()}).catch(n=>{console.warn("Error getting range named '"+e+"':",n),t.next("Named range is empty or does not exist"),t.complete()})})}function q(e){return new U(t=>{Excel.run(async n=>{const r=n.workbook.tables.getItem(e),o=r.getHeaderRowRange().load("values"),i=r.getDataBodyRange().load("values");try{await n.sync()}catch(t){throw console.error("Error getting rows for table '"+e+"':",t),t}const s=o.values[0];i.values.forEach(e=>{const n=s.reduce((t,n,r)=>(t[n]=e[r],t),{});t.next(n)}),t.complete()}).catch(e=>t.error(e))})}async function W(e,t){try{if(console.log(`WriteToTable called for '${e}' with ${t.length} rows.`),0===t.length)return void console.warn("No data to write to table '"+e+"'.");await Excel.run(async n=>{console.log(`WriteToTable: Getting table '${e}'...`);const r=n.workbook.tables.getItemOrNullObject(e);if(await n.sync(),r.isNullObject)throw new Error(`Table "${e}" not found.`);console.log(`WriteToTable: Adding rows to '${e}'...`),r.rows.add(null,t),await n.sync(),console.log(`WriteToTable: Successfully added rows to '${e}'.`)})}catch(n){throw console.error(`Error writing to table '${e}':`,n),console.error("Could not add data to table '"+e+"':",t),n}}async function Y(){return new Promise((e,t)=>{q("ExpenseData").pipe(N(e=>e["Expense Type"]),F(),B(t=>{const n=t.map(e=>(e??"").toString().trim()).filter(e=>e.length>0),r=Array.from(new Set(n));e(r)})).subscribe({error(){H("Expenses").pipe(F(),B(t=>{const n=t.map(e=>(e??"").toString().trim()).filter(e=>e.length>0&&"Named range is empty or does not exist"!==e);e(Array.from(new Set(n)))})).subscribe({error(e){t(e)}})}})})}async function K(){return new Promise((e,t)=>{q("Transactions").pipe(F(),B(t=>e(t))).subscribe({error:e=>t(e)})})}async function J(){return new Promise((e,t)=>{q("Rollovers").pipe(F()).subscribe({next:t=>e(t),error:e=>t(e)})})}async function Q(){return new Promise((e,t)=>{q("ExpenseData").pipe(F(),B(t=>e(t))).subscribe({error(e){t(e)}})})}async function V(){return new Promise((e,t)=>{q("BudgetHistory").pipe(F(),B(t=>e(t))).subscribe({error(e){t(e)}})})}var G=n(44809),Z=n.n(G);class X{static fromCsv(e){const t=Z().parse(e,{header:!0}).data;return t.forEach(async e=>{e["Description 1"]?(e.id=await async function(e){const t=function(e){return(new TextEncoder).encode(`\n    ${e["Transaction Date"]}\n    ${e["Account Number"]}\n    ${e["Description 1"]}\n    ${e["Description 2"]}\n    ${e.CAD$}\n    ${e.USD$}\n  `)}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}(e),e["Transaction Date"]=new Date(e["Transaction Date"]),e.Month=e["Transaction Date"].getMonth()+1,e.Year=e["Transaction Date"].getFullYear(),e.Date=e["Transaction Date"].toLocaleDateString(),e.CAD$=e.CAD$?parseFloat(e.CAD$.toString()):null,e.USD$=e.USD$?parseFloat(e.USD$.toString()):null,e.Amount=e.USD$||e.CAD$||0,e.Description=e["Description 1"]+" "+e["Description 2"]):t.splice(t.indexOf(e),1)}),t}}function ee(e,t){if("undefined"==typeof document)return void console.error(`[${t}]`,e);const n=document.getElementById("error-container"),r=document.getElementById("error-content"),o=document.getElementById("error-details");if(!n||!r||!o)return console.error("Error UI elements not found. Logging to console only."),void console.error(`[${t}]`,e);const i=`--- ERROR REPORT ---\nContext: ${t}\nTime: ${(new Date).toISOString()}\nMessage: ${e instanceof Error?e.message:String(e)}\n\nStack Trace:\n${e instanceof Error?e.stack:"No stack trace available"}\n--------------------`;o.textContent=i,n.style.display="block",console.error(`[${t}]`,e)}function te(){const e=document.getElementById("error-details");if(!e)return;const t=e.textContent||"";navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(t).then(re).catch(e=>{console.warn("Clipboard API failed, trying fallback",e),ne(t)}):ne(t)}function ne(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.opacity="0",t.style.zIndex="-1",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")?(console.log("Fallback copy successful"),re()):console.error("Fallback copy failed (execCommand returned false).")}catch(e){console.error("Fallback copy failed with error:",e)}document.body.removeChild(t)}function re(){const e=document.getElementById("error-copy-btn");if(e){const t=e.textContent;e.textContent="Copied!",setTimeout(()=>e.textContent=t,2e3)}}function oe(){const e=document.getElementById("error-container");e&&(e.style.display="none")}const ie={log:console.log.bind(console),warn:console.warn.bind(console),error:console.error.bind(console)};function se(){return"undefined"==typeof document?null:document.getElementById("console-output")}function ae(e,t){const n=se();if(!n)return;if("function"!=typeof n.appendChild)return;const r=document.createElement("div");r.className=`log-entry ${t}`,r.textContent=`> ${e}`,n.appendChild(r),n.scrollTop=n.scrollHeight}function ce(e,t="info"){ae(e,t)}function ue(e,t="info"){!function(e,t){const n=`[Budget Helper] ${e}`;switch(t){case"error":ie.error(n);break;case"warn":ie.warn(n);break;default:ie.log(n)}}(e,t),ae(e,t)}function le(){const e=se();e&&(e.innerHTML="",ue("Console cleared."))}function de(e){e.preventDefault(),e.stopPropagation()}function fe(e){var t=e.dataTransfer.files;if(t.length>0){var n=t[0];ue(`Reading file: ${n.name}...`,"info");var r=new FileReader;r.onload=he,r.readAsText(n)}}async function he(e){try{var t=e.target.result;ue("Processing transactions...","info");const n=await async function(e){var t=X.fromCsv(e);console.log("Incoming Transactions:",t);const n=await Y();console.log("Expenses:",n);const r=await async function(){return new Promise((e,t)=>{q("MatchingRules").pipe(F()).subscribe({next:t=>e(t),error:e=>t(e)})})}();console.log("Matching Rules:",r);const o=await async function(){return new Promise((e,t)=>{q("AmbiguousItems").pipe(F()).subscribe({next:t=>e(t),error:e=>t(e)})})}();console.log("Ambiguous Items:",o);const i=await async function(){return new Promise((e,t)=>{q("Accounts").pipe(N(e=>{var t={};return t[e.Number]=e.Name,t}),L((e,t)=>({...e,...t}),{})).subscribe({next:t=>e(t),error:e=>t(e)})})}();console.log("accountNames:",i);const s=await async function(){return new Promise((e,t)=>{H("TransactionIds").pipe(F(),B(t=>e(t))).subscribe({error(e){t(e)}})})}(),a=[],c=new Map,u=new Array;return r.forEach(e=>{const t=`${e["Match 1"]}${e["Match 2"]}`;c.set(t,e["Expense Type"]),e["Match 2"]||u.push({match:e["Match 1"],expense:e["Expense Type"]})}),t.forEach(e=>{if(e.id&&s.includes(e.id))return;if(a.push(e),e["Account Name"]=i[e["Account Number"]],e.Account=`${e["Account Name"]} (${e["Account Number"].slice(-4)})`,o.some(t=>e["Description 1"].toLowerCase().includes(t.Item.toLowerCase())))return console.warn("Transaction flagged as ambiguous:",e["Description 1"]),void(e.Expense="Ambiguous");let t=c.get(`${e["Description 1"]}${e["Description 2"]}`);if(t)e.Expense=t;else{for(let t of u)if(e["Description 1"].toLowerCase().includes(t.match.toLowerCase()))return void(e.Expense=t.expense);console.warn("No match found for transaction:",e["Description 1"],e["Description 2"])}}),console.log("New Transactions:",a),a.map(e=>[e.id,e.Month,e.Year,e.Date,e.Account,e.Expense,e.Amount,e.Description,e.Memo])}(t);await W("Transactions",n),ue(`Successfully imported ${n.length} transactions.`,"success");const r=function(e){let t=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY;for(const r of e){const e="number"==typeof r?.[1]?r[1]:parseInt(r?.[1],10),o="number"==typeof r?.[2]?r[2]:parseInt(r?.[2],10);Number.isFinite(e)&&Number.isFinite(o)&&(o<t||o===t&&e<n)&&(t=o,n=e)}return Number.isFinite(t)&&Number.isFinite(n)?n<1||n>12?null:{month:n,year:t}:null}(n);r?(ue(`Suggested recalc start: ${r.month}/${r.year} (earliest imported month).`,"info"),function(e){if("undefined"==typeof document)return;const t=document.getElementById("month-input"),n=document.getElementById("year-input");Boolean(t?.dataset?.userEdited||n?.dataset?.userEdited)||(t&&(t.value=e.month.toString()),n&&(n.value=e.year.toString()),document.dispatchEvent(new Event("budgethelper:inputs-changed")))}(r)):ue("Suggested recalc start: (could not infer from import)","warn")}catch(e){ee(e,"ProcessFileDrop"),ue("Failed to process file.","error")}}function pe(e){if("number"==typeof e&&Number.isFinite(e))return e;const t=parseFloat(String(e));return Number.isFinite(t)?t:null}function ge(e,t){return Number.isFinite(e)&&Number.isFinite(t)?e<1||e>12?null:12*t+(e-1):null}function me(e){const t=pe(e["Month Start"]),n=pe(e["Year Start"]),r=pe(e["Month End"]),o=pe(e["Year End"]);if(null===t||null===n||null===r||null===o)return null;const i=ge(t,n),s=ge(r,o);return null===i||null===s?null:{startIndex:i,endIndex:s}}async function ye(e,t,n=null){let r;const o=null!==n;r=n?[n]:await Y();let i=new Date,s=i.getMonth()+1,a=i.getFullYear();const[c,u,l,d]=await Promise.all([J(),K(),Q(),V()]),f=new Map;c.forEach((e,t)=>{const n=`${e.Month}-${e.Year}-${e.Expense}`;f.set(n,{entry:e,index:t})});const h=new Map;u.forEach(e=>{const t=`${e.Month}-${e.Year}-${e["Expense Type"]}`,n=h.get(t)||{total:0,count:0};h.set(t,{total:n.total+(e.Amount||0),count:n.count+1})});const p=new Map;l.forEach(e=>{p.set(e["Expense Type"],{Budget:parseFloat(e.Budget||0),Init:parseFloat(e.Init||0)})});const g=[],m=[],y=(e,t,n)=>{const{entry:r,matches:i}=function(e,t,n,r){const o=function(e,t,n,r){const o=ge(n,r);if(null===o)return[];const i=[];for(const n of e){if(n.Expense!==t)continue;const e=me(n);e&&e.startIndex<=o&&o<=e.endIndex&&i.push({entry:n,startIndex:e.startIndex,endIndex:e.endIndex})}return i}(e,t,n,r);return 0===o.length?{entry:null,matches:[]}:(o.sort((e,t)=>t.startIndex-e.startIndex),{entry:o[0].entry,matches:o.map(e=>e.entry)})}(d,e,t,n);return i.length>1&&o&&console.warn(`Multiple BudgetHistory matches for ${e} ${t}/${n}:`,i),r?function(e){const t=pe(e);return null===t?0:t}(r.Amount):p.get(e)?.Budget||0},v=e=>p.get(e)?.Init||0;for(const n of r){let r=24,i=e,c=t;if(c>a||c===a&&i>s)return void console.error("Cannot reset rollover for a future date.");for(;(c<a||c===a&&i<=s)&&r>0;){const e=`${i}-${c}-${n}`;let t=f.get(e),s=t?{...t.entry}:null;const a=y(n,i,c);let u=i-1,l=c;0===u&&(u=12,l--);const d=`${u}-${l}-${n}`,p=f.get(d);let b=0;b=p?p.entry.EOM:v(n);const w=h.get(`${i}-${c}-${n}`),_=w?.total||0;if(s||(s={Month:i,Year:c,Expense:n,Expenses:0,BOM:0,EOM:0}),s.Expenses=_,s.BOM=b,s.EOM=s.BOM+a+_,o){const e=w?.count||0,t=p?`${u}/${l}`:"init";console.log(`Rollover ${n} ${i}/${c}: BOM ${b}, Budget ${a}, Spent ${_} (${e} tx), EOM ${s.EOM} (prev: ${t})`)}t?(t.entry=s,g.push({rowIndex:t.index,data:s})):(m.push(s),f.set(e,{entry:s,index:-1})),i++,13===i&&(i=1,c++),r--}}if(g.length>0&&await async function(e,t){0!==t.length&&(console.log(`UpdateTableRows called for '${e}' with ${t.length} updates.`),await Excel.run(async n=>{console.log(`UpdateTableRows: Getting table '${e}'...`);const r=n.workbook.tables.getItem(e),o=r.getHeaderRowRange().load("values");await n.sync();const i=o.values[0];console.log(`UpdateTableRows: Processing updates for '${e}'...`),t.forEach(e=>{const t=r.getDataBodyRange().getRow(e.rowIndex),n=i.map(t=>e.data[t]??null);t.values=[n]}),console.log(`UpdateTableRows: Syncing updates for '${e}'...`),await n.sync(),console.log(`UpdateTableRows: Successfully updated rows in '${e}'.`)}).catch(t=>{throw console.error(`Error updating rows in table '${e}':`,t),t}))}("Rollovers",g),m.length>0){const e=m.map(e=>[e.Month,e.Year,e.Expense,e.Expenses,e.BOM,e.EOM]);await W("Rollovers",e)}await async function(e){const t=e.toISOString().split("T")[0];try{console.log(`Attempting to set Named Range 'LastRolloverUpdate' to ${t}...`),await async function(e,t){console.log(`SetNamedRangeValue called for '${e}' with value '${t}'.`),await Excel.run(async n=>{try{return n.workbook.worksheets.getItem("Rollovers").getRange("H1").values=[[t]],await n.sync(),void console.log("SetNamedRangeValue: Wrote LastRolloverUpdate directly to Rollovers!H1.")}catch(t){console.warn(`Warning: Could not set named range '${e}'. This is non-critical. Error:`,t)}}).catch(t=>{console.warn(`Excel.run failed in SetNamedRangeValue for '${e}':`,t)})}("LastRolloverUpdate",t),console.log("Successfully set Named Range.")}catch(e){console.warn("Failed to set Named Range for Last Update (non-critical):",e)}try{const e=Office?.context?.document?.settings;if(!e?.set||!e?.saveAsync)return void console.warn("Office document settings are unavailable; skipping settings persistence for LastRolloverUpdate.");console.log("Setting Document Settings 'LastRolloverUpdate'..."),e.set("LastRolloverUpdate",t),console.log("Calling saveAsync on Document Settings..."),await new Promise(t=>{e.saveAsync(e=>{console.log("saveAsync callback received. Status:",e.status),e.status===Office.AsyncResultStatus.Failed?console.error("Failed to save to Document Settings:",e.error):console.log("Saved Last Update to Document Settings."),t()})})}catch(e){console.error("Critical error in settings fallback:",e)}}(new Date)}const ve=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];let be=!1;function we(e){const t=e.map(e=>{if("string"==typeof e)return e;try{return JSON.stringify(e)}catch{return String(e)}}).join(" ");return t.length<=2e3?t:t.slice(0,2e3)+"…"}function _e(){if(be)return;be=!0;const e={log:console.log.bind(console),warn:console.warn.bind(console),error:console.error.bind(console)};console.log=(...t)=>{e.log(...t),ce(we(t),"info")},console.warn=(...t)=>{e.warn(...t),ce(we(t),"warn")},console.error=(...t)=>{e.error(...t),ce(we(t),"error")}}async function Ee(){try{await async function(){"loading"===document.readyState&&await new Promise(e=>{document.addEventListener("DOMContentLoaded",()=>e(),{once:!0})})}(),_e();const e=document.getElementById("app-version");if(e){const t="2.1.3.0";e.textContent=`v${t}`}ue("Verbose logging enabled (capturing console output).","info"),ue("Initializing...","info"),await async function(){try{await async function(e,t,n=e){await Excel.run(async r=>{const o=r.workbook.tables.getItemOrNullObject(e);if(await r.sync(),!o.isNullObject)return;console.log(`Table '${e}' not found. Creating it...`);let i=r.workbook.worksheets.getItemOrNullObject(n);await r.sync(),i.isNullObject&&(console.log(`Sheet '${n}' not found. Creating it...`),i=r.workbook.worksheets.add(n));const s=`A1:${String.fromCharCode("A".charCodeAt(0)+t.length-1)}1`,a=i.tables.add(s,!0);a.name=e,a.getHeaderRowRange().values=[t],await r.sync(),console.log(`Table '${e}' created successfully.`)}).catch(t=>{throw console.error(`Error ensuring table '${e}' exists:`,t),t})}("AmbiguousItems",["Item","IsAmbiguous","OverrideCount","Confidence"])}catch(e){console.error("Schema initialization failed:",e)}}(),await async function(){try{ue("Loading expense categories...","info");const e=await Y(),t=document.getElementById("expense-dropdown");if(!t)return void ue("Expense dropdown element not found.","error");t.replaceChildren();const n=document.createElement("option");n.value="",n.text="All Expenses",t.appendChild(n);for(const n of e){const e=document.createElement("option");e.value=e.text=n,t.appendChild(e)}const r=e.slice(0,3).join(", ");ue(`Loaded ${e.length} expense categories.`,"info"),ue(`Dropdown now has ${t.options.length} options (sample: ${r||"n/a"}).`,"info")}catch(e){ee(e,"populateExpenseDropdown")}}(),await Ie(),Re(),ue("Ready.","success")}catch(e){ee(e,"initializeTaskpane"),ue("Initialization failed.","error")}}function xe(e){return document.getElementById(e)||null}function Se(e,t){return 12*t+(e-1)}function ke(e,t){return`${ve[e-1]??`M${e}`} ${t}`}function Re(){const e=document.getElementById("reset");if(!e)return;const{month:t,year:n}=function(){const e=xe("month-input"),t=xe("year-input"),n=e?parseInt(e.value,10):NaN,r=t?parseInt(t.value,10):NaN;return{month:Number.isFinite(n)?n:null,year:Number.isFinite(r)?r:null}}();if(!t||!n)return void(e.textContent="Recalc");const r=function(e,t){if(e<1||e>12||t<1900||t>2500)return null;const n=new Date,r=n.getMonth()+1,o=n.getFullYear(),i=Se(e,t),s=Se(r,o);if(i>s)return null;const a=s-i+1;return`Recalc ${ke(e,t)} → ${ke(r,o)} (${a} mo)`}(t,n);e.textContent=r??"Recalc"}function Ce(){const e=xe("month-input"),t=xe("year-input");e?.dataset&&(e.dataset.userEdited="1"),t?.dataset&&(t.dataset.userEdited="1")}async function Ie(){try{const e=await async function(){const e=Office?.context?.document?.settings?.get?.("LastRolloverUpdate");if(e)return new Date(e);try{const e=await Excel.run(async e=>{const t=e.workbook.worksheets.getItemOrNullObject("Rollovers");if(t.load("name"),await e.sync(),t.isNullObject)return null;const n=t.getRange("H1");return n.load("values"),await e.sync(),n.values?.[0]?.[0]??null});if(e)return new Date(e)}catch(e){console.warn("Could not read Rollovers!H1 for LastRolloverUpdate:",e)}return null}(),t=document.getElementById("last-updated");if(e){if(t&&(t.textContent=`Synced: ${e.toISOString().split("T")[0]}`),!function(){const e=xe("month-input"),t=xe("year-input");return Boolean(e?.dataset?.userEdited||t?.dataset?.userEdited)}()){const t=xe("month-input"),n=xe("year-input");t&&(t.value=(e.getMonth()+1).toString()),n&&(n.value=e.getFullYear().toString()),Re()}ue(`Last sync found: ${e.toLocaleDateString()}`,"info")}else t&&(t.textContent="Synced: Never"),ue("No previous sync date found.","warn")}catch(e){console.error("Error fetching last update:",e)}}async function Oe(){try{ue("Starting rollover recalculation...","info");var e=parseInt(document.getElementById("month-input").value),t=parseInt(document.getElementById("year-input").value);let n=document.getElementById("expense-dropdown"),r=n.options[n.selectedIndex].text;"All Expenses"===r&&(r=null),await Excel.run(async n=>{await ye(e,t,r),await n.sync()}),ue("Recalculation complete.","success"),await Ie()}catch(e){ee(e,"TriggerResetRollovers"),ue("Error during recalculation.","error")}}Office.onReady(e=>{if(e.host===Office.HostType.Excel){_e(),ue("Office ready (Excel).","info"),document.getElementById("error-close-btn").addEventListener("click",oe),document.getElementById("error-copy-btn").addEventListener("click",te),document.getElementById("clear-console").addEventListener("click",le);const e=new Date,t=xe("month-input"),n=xe("year-input");t&&(t.value=(e.getMonth()+1).toString()),n&&(n.value=e.getFullYear().toString());let r=document.getElementById("drop-area");["dragenter","dragover","dragleave","drop"].forEach(e=>{r.addEventListener(e,de,!1)}),["dragenter","dragover"].forEach(e=>{r.addEventListener(e,e=>{r.classList.add("highlight")},!1)}),["dragleave","drop"].forEach(e=>{r.addEventListener(e,e=>{r.classList.remove("highlight")},!1)}),r.addEventListener("drop",fe,!1),document.getElementById("reset").onclick=Oe,t?.addEventListener?.("input",()=>{Ce(),Re()}),n?.addEventListener?.("input",()=>{Ce(),Re()});const o=document.getElementById("expense-dropdown")||null;o?.addEventListener?.("change",()=>Re()),document.addEventListener("budgethelper:inputs-changed",()=>Re()),Ee()}})}(),function(){"use strict";var e=n(14385),t=n.n(e),r=new URL(n(58394),n.b);t()(r)}()}();
//# sourceMappingURL=taskpane.js.map